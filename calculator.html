<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ë„˜ê¸°ê¸° ì‘ì—… ê³„ì‚°ê¸° (24ì¸ì¹˜ ìµœì í™”)</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
/* -------------------- ì „ì—­ ìŠ¤íƒ€ì¼ -------------------- */
html, body {
    margin:0;padding:0;height:100%;overflow:hidden;
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background:#1a1a2e;color:#fff;
}
h1{
    text-align:center;margin:0;padding:16px;font-size:30px;
    color:#f0f0f0;position: relative; z-index: 2; background:#1a1a2e;
}
.content-wrapper {
    position: absolute; top:62px; left:0; right:0; bottom:0; 
    overflow-y:auto; overflow-x:hidden; padding-bottom:20px; 
    z-index:1; display:flex; flex-direction:column; align-items:center;
}

/* -------------------- ì£¼ìš” ë ˆì´ì•„ì›ƒ ì¡°ì • (700px) -------------------- */
.top-area {
    width:90%; 
    max-width:1050px; /* ê¸°ë¡ íŒ¨ë„ì„ ìœ„í•´ ìµœëŒ€ ë„ˆë¹„ ì¦ê°€ */
    display:flex; justify-content:space-between; gap:15px; 
    margin:20px auto 10px auto;
}
@media (max-width:1000px){
    /* í™”ë©´ì´ ì¢ì•„ì§€ë©´ ê¸°ë¡ íŒ¨ë„ì„ ì•„ë˜ë¡œ ë°°ì¹˜ */
    .top-area{flex-wrap: wrap;}
    .record-panel{order: 3; width: 100%; max-width: 700px; margin-top: 15px;}
}
@media (max-width:600px){
    /* ë” ì¢ì•„ì§€ë©´ ê¸°ì¡´ íŒ¨ë„ë„ ì„¸ë¡œ ë°°ì¹˜ */
    .top-area{flex-direction:column;gap:15px;}
    .record-panel{margin-top: 0;}
}

.info-panel, .prod-panel, .record-panel {
    background:#252540;padding:18px;border-radius:14px;box-shadow:0 4px 15px rgba(0,0,0,0.3);
}
.info-panel{flex:1;min-width:250px;}
.prod-panel{flex:2;min-width:300px;}
.record-panel{flex:1;min-width:250px;} /* ìƒˆë¡œìš´ ê¸°ë¡ íŒ¨ë„ ìŠ¤íƒ€ì¼ */

.prod-list{margin-top:12px; max-height:40vh; overflow-y:auto; padding-right:10px;}
.prod-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.prod-row div{font-size:16px;font-weight:600;min-width:70px;margin-bottom:0;}
.prod-row input{width:calc(100% - 80px) !important; padding:12px;}

/* ê¸°ë¡ ëª©ë¡ ìŠ¤íƒ€ì¼ */
.record-list{margin-top:12px; max-height:40vh; overflow-y:auto; padding-right:10px;}
.record-item{
    display:flex; justify-content:space-between; align-items:center;
    padding:10px; border-bottom: 1px solid #3e3e60; 
    cursor:pointer; transition: background 0.1s;
}
.record-item:hover{background: #333355;}
.record-item:last-child{border-bottom:none;}
.record-details{flex:1;}
.record-date{font-size:14px; color:#b0b0d0;}
.record-summary{font-size:16px; font-weight:700;}
.record-delete{
    background:none; border:none; color:#e74c3c; 
    font-size:18px; font-weight:bold; cursor:pointer; 
    padding:5px; margin-left:10px;
}

/* -------------------- í‚¤íŒ¨ë“œ ì¡°ì • (400px) -------------------- */
#softKeypad{
    width:90%; 
    max-width:400px; 
    background:#252540; padding:10px; 
    grid-template-columns: repeat(4, 1fr); gap:8px; 
    border-radius:14px; box-shadow:0 4px 15px rgba(0,0,0,0.5); 
    z-index:1000; margin:20px auto;
}
.keypad-button{padding:18px;font-size:26px;font-weight:bold;background:#4a4a75;color:#fff;border:none;border-radius:8px;user-select:none;cursor:pointer;transition:background 0.1s;touch-action:manipulation;}
.keypad-button:active{background:#3a3a60;}
.keypad-action{background:#e74c3c !important;}
.keypad-action:active{background:#c0392b !important;}
#enterKey{grid-column:span 1; background:#3498db !important;}
#enterKey:active{background:#2980b9 !important;}

/* -------------------- ê²°ê³¼ ë° ê¸°íƒ€ ìŠ¤íƒ€ì¼ -------------------- */
.cuts{width:90%; max-width:700px; margin:0 auto 20px auto; text-align:center;}
.cuts h3{margin-bottom:10px;color:#3498db;font-size:20px;} 
.cut-row{display:flex;justify-content:space-between;align-items:center;padding:15px;border-radius:12px;background:#252540;margin-bottom:8px;box-shadow:0 2px 8px rgba(0,0,0,0.2);}
.cut-left{display:flex;flex-direction:column;text-align:left;}
.prod-name{font-size:20px;font-weight:700;color:#f0f0f0;}
.prod-len{font-size:12px;color:#b0b0d0;} 
.cut-pos{font-size:36px;font-weight:900;color:#e74c3c;}

/* ì „ì²´í™”ë©´ ì¬ë‹¨í‘œ (ê°€ë…ì„± ê°œì„  ë¶€ë¶„) */
#fsCuts .prod-name{font-size:24px;font-weight:900;color:#3498db;}
#fsCuts .main-len{font-size:20px; font-weight:700; color: #f0f0f0; margin-top: 4px;} 
#fsCuts .required-len{font-size:14px; color:#b0b0d0; font-weight:500;}
#fsCuts .cut-pos{font-size:48px;color:#e74c3c;}

label{display:block;margin-top:14px;font-size:16px;font-weight:600;color:#ccc;}
input{width:100%;padding:14px;font-size:19px;border-radius:8px;border:1px solid #3e3e60;margin-top:6px;background:#333355;color:#fff;box-sizing:border-box;cursor:pointer;}
.buttons{margin-top:18px;display:flex;justify-content:space-between;flex-wrap:wrap;}
.buttons button{flex:1;margin:4px;padding:12px 0;font-size:17px;border-radius:10px;border:none;background:#3a79d8;color:#fff;font-weight:700;transition:background 0.2s; user-select:none;}
.buttons button:active{background:#2a69c8;}

/* -------------------- ì „ì²´í™”ë©´ ìŠ¤íƒ€ì¼ -------------------- */
.fullscreen{display:none;position:fixed;inset:0;background:#1a1a2e;z-index:9999;flex-direction:column;align-items:center;justify-content:flex-start;padding-top:40px;overflow-y:hidden;}
.fs-title{font-size:36px;margin-bottom:10px;color:#3498db;font-weight:700;}
.fs-summary { 
    font-size: 24px;
    color: #e74c3c; 
    margin-bottom: 10px;
    font-weight: 700;
}
.fs-info {
    font-size: 18px;
    color: #ccc;
    margin-bottom: 20px;
    font-weight: 500;
    white-space: pre-wrap;
    text-align: center;
}
.fs-sub{
    font-size:18px;
    color:#ccc;
    margin-bottom:20px; 
    white-space:pre-wrap; 
    text-align:center;
    max-width: 300px;
} 
.cuts-fs{max-height: calc(100vh - 120px); overflow-y:auto; width:95%; max-width:700px; margin-bottom:20px;} 
.controls-bottom{position:fixed;bottom:20px;display:flex;gap:12px;}
.controls-bottom button{padding:16px 25px;font-size:19px;border-radius:12px;border:none;background:#e74c3c;color:#fff;font-weight:700;}
.controls-bottom button:active{background:#c0392b;}

/* -------------------- ëª¨ë‹¬ ìŠ¤íƒ€ì¼ -------------------- */
.custom-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:10000;justify-content:center;align-items:center;padding:20px;}
.custom-modal-content{background:#252540;padding:30px;border-radius:15px;box-shadow:0 8px 25px rgba(0,0,0,0.5);max-width:400px;width:90%;text-align:center;}
.modal-title{font-size:24px;font-weight:bold;color:#e74c3c;margin-bottom:15px;}
.modal-message{font-size:17px;color:#f0f0f0;margin-bottom:25px;white-space:pre-wrap;}
.modal-buttons button{padding:12px 20px;font-size:17px;border-radius:8px;border:none;font-weight:700;cursor:pointer;transition:background 0.2s;user-select:none;}
#modalConfirmBtn{background:#e74c3c;color:#fff;margin-left:10px;}
#modalConfirmBtn:active{background:#c0392b;}
#modalCancelBtn{background:#555;color:#fff;}
#modalCancelBtn:active{background:#444;}
</style>
</head>
<body onload="loadResults()"> 
<h1>ë„˜ê¸°ê¸° ì‘ì—… ê³„ì‚°ê¸°</h1>

<div class="content-wrapper">
<div class="top-area">
<div class="info-panel">
<label>ì´ ì›ë‹¨ ê¸¸ì´ (m)</label>
<input type="text" readonly id="totalInput" placeholder="ì˜ˆ: 501.54">
<label>ì—¬ìœ ìœ¨ (%)</label>
<input type="text" readonly id="marginInput" placeholder="ì˜ˆ: 2" value="2">
<div class="buttons">
<button id="calcBtn" type="button">ê³„ì‚°í•˜ê¸°</button>
<button id="resetBtn" type="button">ì´ˆê¸°í™”</button>Â 
</div>
<div class="buttons">
<button id="fsBtn" type="button">ì‘ì—…í‘œ - ì „ì²´í™”ë©´</button>Â 
</div>
</div>

<div class="prod-panel">
<label>ì œí’ˆ ê¸¸ì´ (m) (ìŠ¤í¬ë¡¤)</label>
<div class="prod-list" id="prodList"></div>
<div class="buttons">
<button id="addProd" type="button">+ ì œí’ˆ ì¶”ê°€</button>
<button id="removeProd" type="button">- ì œí’ˆ ì œê±°</button>
</div>
</div>

<div class="record-panel">
    <label>ì €ì¥ëœ ê³„ì‚° ê¸°ë¡ (í´ë¦­í•˜ì—¬ ë¶ˆëŸ¬ì˜¤ê¸°)</label>
    <div class="record-list" id="recordList">
        <div style="padding:15px; text-align:center; color:#ccc;">ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    </div>
</div>
</div>

<div class="cuts" id="previewCuts">
<h3>ê³„ì‚° ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° (ì¬ë‹¨ ìœ„ì¹˜)</h3>
<div style="padding:15px; text-align:center; color:#ccc;">ê³„ì‚°ëœ ì¬ë‹¨ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
</div>

<div id="softKeypad" style="display: none;"> 
<button class="keypad-button" data-key="7">7</button>
<button class="keypad-button" data-key="8">8</button>
<button class="keypad-button" data-key="9">9</button>
<button class="keypad-button keypad-action" data-key="back">âŒ«</button>
<button class="keypad-button" data-key="4">4</button>
<button class="keypad-button" data-key="5">5</button>
<button class="keypad-button" data-key="6">6</button>
<button class="keypad-button" data-key=".">.</button>
<button class="keypad-button" data-key="1">1</button>
<button class="keypad-button" data-key="2">2</button>
<button class="keypad-button" data-key="3">3</button>
<button class="keypad-button keypad-action" data-key="enter" id="enterKey">í™•ì¸</button>
<button class="keypad-button" data-key="0">0</button>
<div style="grid-column: span 3; display: none;"></div>
</div>
</div>

<div id="fsContainer" class="fullscreen">
Â  <div class="fs-title">ì¬ë‹¨ ìœ„ì¹˜ í‘œì‹œ (ì •ìˆ˜ m ë²„ë¦¼)</div>
Â  <div class="fs-summary" id="fsSummary"></div> 
  <div class="fs-info" id="fsInfo"></div> 
Â  <div class="fs-sub" id="fsSub"></div>
Â  <div class="cuts cuts-fs" id="fsCuts"></div>
Â  <div class="controls-bottom">
Â  Â  <button id="exitBtn" type="button">ì¢…ë£Œ</button>
Â  </div>
</div>

<div id="customModalOverlay" class="custom-modal-overlay">
<div class="custom-modal-content">
<div id="modalTitle" class="modal-title">ê²½ê³ </div>
<div id="modalMessage" class="modal-message"></div>
<div class="modal-buttons">
<button id="modalCancelBtn" type="button">ì·¨ì†Œ</button>
<button id="modalConfirmBtn" type="button">í™•ì¸</button>
</div>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
const MAX_PROD = 20;
const STORAGE_KEY = 'cutCalculatorRecords';
const prodList = document.getElementById('prodList');
const recordList = document.getElementById('recordList'); // ğŸŒŸ ì¶”ê°€
const totalInput = document.getElementById('totalInput');
const marginInput = document.getElementById('marginInput');
const addBtn = document.getElementById('addProd');
const removeBtn = document.getElementById('removeProd');
const calcBtn = document.getElementById('calcBtn');
const resetBtn = document.getElementById('resetBtn');
const previewCuts = document.getElementById('previewCuts');
const fsBtn = document.getElementById('fsBtn');
const fsContainer = document.getElementById('fsContainer');
const exitBtn = document.getElementById('exitBtn');
const softKeypad = document.getElementById('softKeypad');
const fsSummary = document.getElementById('fsSummary'); 

const customModalOverlay = document.getElementById('customModalOverlay');
const modalTitle = document.getElementById('modalTitle');
const modalMessage = document.getElementById('modalMessage');
const modalConfirmBtn = document.getElementById('modalConfirmBtn');
const modalCancelBtn = document.getElementById('modalCancelBtn');

let cutPlan = [];
let focusedInput = null;Â 
let modalCallback = null;

// ==========================================
// ğŸŒŸ ê¸°ë¡ ì €ì¥ ë° ë¶ˆëŸ¬ì˜¤ê¸° ë¡œì§
// ==========================================

function getRecords(){
    try {
        const json = localStorage.getItem(STORAGE_KEY);
        return json ? JSON.parse(json) : [];
    } catch (e) {
        console.error("Error reading localStorage:", e);
        return [];
    }
}

function saveRecords(records){
    try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
    } catch (e) {
        console.error("Error writing localStorage:", e);
        showModal('ì €ì¥ ì˜¤ë¥˜', 'ê³„ì‚° ê¸°ë¡ì„ ê¸°ê¸°ì— ì €ì¥í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', false);
    }
}

function saveResult(){
    const currentRecords = getRecords();
    const prodInputs = [];
    prodList.querySelectorAll('input').forEach(input => {
        if(parseFloat(input.value)>0) prodInputs.push(input.value);
    });

    if (prodInputs.length === 0) return; // ìœ íš¨ ì œí’ˆ ì—†ìœ¼ë©´ ì €ì¥ ì•ˆ í•¨

    const newRecord = {
        id: Date.now(),
        timestamp: new Date().toLocaleString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' }),
        totalInput: totalInput.value,
        marginInput: marginInput.value,
        prodInputs: prodInputs,
        cutPlan: cutPlan 
    };

    currentRecords.unshift(newRecord); // ìµœì‹  ê¸°ë¡ì„ ë§¨ ì•ìœ¼ë¡œ ì¶”ê°€
    saveRecords(currentRecords);
    renderRecords(currentRecords);
}

function restoreRecord(record){
    // 1. ê¸°ì¡´ ì œí’ˆ ëª©ë¡ ì´ˆê¸°í™”
    prodList.innerHTML = '';
    
    // 2. ì´ ì›ë‹¨ ê¸¸ì´ ë° ì—¬ìœ ìœ¨ ë³µì›
    totalInput.value = record.totalInput;
    marginInput.value = record.marginInput;

    // 3. ì œí’ˆ ì…ë ¥ í•„ë“œ ë³µì›
    record.prodInputs.forEach(val => createProdInput(val));
    
    // 4. ë‚˜ë¨¸ì§€ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™” (ë§Œì•½ 6ê°œë³´ë‹¤ ì ìœ¼ë©´)
    let currentProdCount = prodList.querySelectorAll('.prod-row').length;
    while(currentProdCount < 6){
        createProdInput('');
        currentProdCount++;
    }

    // 5. ê³„ì‚° ê²°ê³¼ (ë¯¸ë¦¬ë³´ê¸°) ë³µì›
    cutPlan = record.cutPlan;
    renderPreview();
    
    showModal('ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°','ì„ íƒí•œ ê¸°ë¡ìœ¼ë¡œ ê³„ì‚°ê¸° ì…ë ¥ê°’ì´ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤. ì¬ê³„ì‚° ë˜ëŠ” ì „ì²´í™”ë©´ì„ í™•ì¸í•˜ì„¸ìš”.',false);
}

function deleteRecord(id){
    showModal('ê¸°ë¡ ì‚­ì œ í™•ì¸','ì„ íƒí•œ ê¸°ë¡ì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',true,(confirmed)=>{
        if(confirmed){
            let currentRecords = getRecords();
            currentRecords = currentRecords.filter(record => record.id !== id);
            saveRecords(currentRecords);
            renderRecords(currentRecords);
        }
    });
}

function renderRecords(records){
    recordList.innerHTML = '';
    if(records.length === 0){
        recordList.innerHTML = '<div style="padding:15px; text-align:center; color:#ccc;">ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }

    records.forEach(record => {
        const item = document.createElement('div');
        item.className = 'record-item';
        item.setAttribute('data-id', record.id);
        
        // í´ë¦­ ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
        item.addEventListener('click', (e) => {
            // ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ì™€ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ë°©ì§€
            if(e.target.className.includes('record-delete')) return; 
            restoreRecord(record);
        });

        const numProds = record.prodInputs.length;
        const totalLen = parseFloat(record.totalInput).toFixed(2);

        item.innerHTML = `
            <div class="record-details">
                <div class="record-date">${record.timestamp}</div>
                <div class="record-summary">ì´ ${totalLen}m / ì œí’ˆ ${numProds}ê°œ</div>
            </div>
            <button class="record-delete" type="button" data-id="${record.id}">âŒ</button>
        `;

        item.querySelector('.record-delete').addEventListener('click', (e) => {
            e.stopPropagation(); // ë¶€ëª¨ ìš”ì†Œ(ë¶ˆëŸ¬ì˜¤ê¸°) í´ë¦­ ë°©ì§€
            deleteRecord(record.id);
        });

        recordList.appendChild(item);
    });
}

function loadResults(){
    renderRecords(getRecords());
}

// ==========================================
// ê¸°ì¡´ ë¡œì§
// ==========================================

function getAllInputs() {
Â  Â  const allInputs = [totalInput, marginInput];
Â  Â  prodList.querySelectorAll('input').forEach(input => allInputs.push(input));
Â  Â  return allInputs;
}

function removeFocus(input) {
Â  Â  if(input) input.style.border='1px solid #3e3e60';
}

function inputClickHandler(event){
Â  Â  removeFocus(focusedInput);
Â  Â  focusedInput = event.target;
Â  Â  focusedInput.style.border='1px solid #3498db';
Â  Â  // í‚¤íŒ¨ë“œ í‘œì‹œ
Â  Â  softKeypad.style.display='grid'; 
Â  Â  setTimeout(()=>{focusedInput.scrollIntoView({behavior:'smooth',block:'center'})},100);
}

function createProdInput(value){
Â  Â  const count = prodList.querySelectorAll('.prod-row').length + 1;
Â  Â  if(count>MAX_PROD) return;
    
    const label = `ì œí’ˆ ${count}`; 

Â  Â  const row=document.createElement('div');
Â  Â  row.className='prod-row';
Â  Â  row.innerHTML=`<div>${label}</div><input type="text" readonly placeholder="${label} ê¸¸ì´ (m)" value="${value!==undefined?value:''}">`;
Â  Â  const input=row.querySelector('input');
Â  Â  input.addEventListener('click', inputClickHandler);
Â  Â  prodList.appendChild(row);

    // ìƒˆë¡œ ì¶”ê°€ëœ input í•„ë“œë¡œ ìŠ¤í¬ë¡¤ (í™”ë©´ í™•ëŒ€ ë°©ì§€)
    setTimeout(() => {
        input.scrollIntoView({ behavior: 'smooth', block: 'end' }); 
    }, 100); 
}

function initializeProdInputs(){
Â  Â  removeFocus(focusedInput);
Â  Â  focusedInput=null;
Â  Â  softKeypad.style.display='none';
Â  Â  prodList.innerHTML='';
Â  Â  cutPlan=[];
Â  Â  for(let i=0;i<6;i++) createProdInput();
}

totalInput.addEventListener('click', inputClickHandler);
marginInput.addEventListener('click', inputClickHandler);
initializeProdInputs();

softKeypad.addEventListener('click',(event)=>{
Â  Â  const key=event.target.dataset.key;
Â  Â  if(!key||!focusedInput) return;
Â  Â  if(key==='enter'){Â 
Â  Â  Â  Â  const allInputs = getAllInputs();
Â  Â  Â  Â  const idx = allInputs.indexOf(focusedInput);
Â  Â  Â  Â  removeFocus(focusedInput); focusedInput=null;
Â  Â  Â  Â  if(idx!==-1 && idx<allInputs.length-1) inputClickHandler({target:allInputs[idx+1]});
Â  Â  Â  Â  else softKeypad.style.display='none';
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  let val=focusedInput.value;
Â  Â  if(key==='back'){ focusedInput.value=val.slice(0,-1); }
Â  Â  else if(key==='.'){ if(!val.includes('.')) focusedInput.value=val+'.'; }
Â  Â  else{Â 
Â  Â  Â  Â  if(val.includes('.')){ const dec=val.split('.')[1]; if(dec && dec.length>=2) return; }
Â  Â  Â  Â  if(key>='0'&&key<='9') focusedInput.value=val+key;
Â  Â  }
});

document.addEventListener('click',(event)=>{
Â  Â  // í‚¤íŒ¨ë“œ ë‹«ê¸° ë¡œì§
    const isInput = event.target.tagName === 'INPUT';
    const isInPanel = event.target.closest('.info-panel') || event.target.closest('.prod-panel') || event.target.closest('.record-panel'); // ğŸŒŸ ê¸°ë¡ íŒ¨ë„ ì¶”ê°€
    const isInKeypad = event.target.closest('#softKeypad');

    if(!isInput && !isInPanel && !isInKeypad && softKeypad.style.display === 'grid'){
        softKeypad.style.display='none';
        removeFocus(focusedInput); focusedInput=null;
    }
});

addBtn.addEventListener('click',()=>{createProdInput();});
removeBtn.addEventListener('click',()=>{
Â  Â  const rows=prodList.querySelectorAll('.prod-row');
Â  Â  if(rows.length===1){ showModal('ê²½ê³ ',"ìµœì†Œí•œ 1ê°œì˜ ì œí’ˆì€ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.",false); return; }
Â  Â  const lastInput=rows[rows.length-1].querySelector('input');
Â  Â  if(focusedInput===lastInput){ removeFocus(focusedInput); focusedInput=null; softKeypad.style.display='none'; }
Â  Â  prodList.removeChild(rows[rows.length-1]);
});

resetBtn.addEventListener('click',(e)=>{
Â  Â  e.preventDefault();
Â  Â  showModal('ì´ˆê¸°í™” í™•ì¸','ëª¨ë“  ì…ë ¥ê°’ê³¼ ê³„ì‚° ê²°ê³¼ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ê¸°ë¡ì€ ì‚­ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)',true,(confirmed)=>{
Â  Â  Â  Â  if(confirmed){
Â  Â  Â  Â  Â  Â  totalInput.value=''; 
Â  Â  Â  Â  Â  Â  marginInput.value='2';
Â  Â  Â  Â  Â  Â  initializeProdInputs();
Â  Â  Â  Â  Â  Â  previewCuts.innerHTML='<h3>ê³„ì‚° ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° (ì¬ë‹¨ ìœ„ì¹˜)</h3><div style="padding:15px; text-align:center; color:#ccc;">ê³„ì‚°ëœ ì¬ë‹¨ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
Â  Â  Â  Â  Â  Â  fsContainer.style.display='none';
Â  Â  Â  Â  Â  Â  // localStorage.clear(); // ì „ì²´ ê¸°ë¡ ì‚­ì œëŠ” ë³„ë„ ê¸°ëŠ¥ìœ¼ë¡œ ì œê³µí•˜ì§€ ì•ŠìŒ
Â  Â  Â  Â  }
Â  Â  });
});

function buildCutPlan(){
Â  Â  softKeypad.style.display='none'; removeFocus(focusedInput); focusedInput=null;
Â  Â  const total_m=parseFloat(totalInput.value);
Â  Â  const total_mm=Math.round(total_m*1000);
Â  Â  
Â  Â  if(isNaN(total_m)||total_m<=0){ showModal('ê²½ê³ ','ì´ ì›ë‹¨ ê¸¸ì´(m)ë¥¼ 0ë³´ë‹¤ í¬ê²Œ ì…ë ¥í•´ ì£¼ì„¸ìš”.',false); return false; }

Â  Â  const margin_perc = parseFloat(marginInput.value) || 0;
Â  Â  const lens_mm=[]; let isValid=true;
Â  Â  prodList.querySelectorAll('input').forEach((i,idx)=>{
Â  Â  Â  Â  const v_m=parseFloat(i.value); 
Â  Â  Â  Â  if(!isNaN(v_m)&&v_m>0){
Â  Â  Â  Â  Â  Â  const len_mm = Math.round(v_m * 1000); 
            let required_mm;
            
            // ë¡¤ë°±ëœ ì—¬ìœ ìœ¨ ë¡œì§ (ì…ë ¥ê°’ v_m ê¸°ì¤€)
            if (v_m < 50) {
                // 50m ë¯¸ë§Œ: 1m ê³ ì • ì—¬ìœ  (1000mm)
                required_mm = len_mm + 1000;
            } else if (v_m >= 50 && v_m < 100) {
                // 50m ì´ìƒ 100m ë¯¸ë§Œ: 2m ê³ ì • ì—¬ìœ  (2000mm)
                required_mm = len_mm + 2000;
            } else { // v_m >= 100m
                // 100m ì´ìƒ: ê¸°ì¡´ ì—¬ìœ ìœ¨(%) ì ìš©
                required_mm = Math.ceil(len_mm * (1 + margin_perc / 100));
            }
            
Â  Â  Â  Â  Â  Â  lens_mm.push({len_mm, required_mm});
Â  Â  Â  Â  }
Â  Â  });
Â  Â  if(!isValid) return false;
Â  Â  if(lens_mm.length===0){ showModal('ê²½ê³ ','ìœ íš¨í•œ ì œí’ˆ ê¸¸ì´(m)ë¥¼ 1ê°œ ì´ìƒ ì…ë ¥í•´ ì£¼ì„¸ìš”.',false); return false; }

Â  Â  cutPlan=[];
Â  Â  let cumulative=0;
Â  Â  for(let i=0;i<lens_mm.length;i++){
        const item_mm = lens_mm[i];
Â  Â  Â  Â  const required_mm = item_mm.required_mm;
Â  Â  Â  Â  cumulative+=required_mm;
Â  Â  Â  Â  if(cumulative>total_mm){
Â  Â  Â  Â  Â  Â  showModal('ì‘ì—… ì¤‘ë‹¨ ê²½ê³ ',`â›” ì‘ì—… ì¤‘ë‹¨: ì´ ì›ë‹¨ ê¸¸ì´ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤!\nì œí’ˆ ${i+1} (${(item_mm.len_mm/1000).toFixed(2)}m) ì¬ë‹¨ ì‹œ ì´ ì›ë‹¨ ê¸¸ì´ (${total_m.toFixed(2)}m) ì´ˆê³¼.`,false); 
Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  }
Â  Â  Â  Â  const remaining_mm=total_mm-cumulative;
        // ì¬ë‹¨ ìœ„ì¹˜ëŠ” ì •ìˆ˜ m ë²„ë¦¼ìœ¼ë¡œ í‘œì‹œ (ì‘ì—… í¸ì˜ì„±)
Â  Â  Â  Â  cutPlan.push({
            index:i+1, 
            prodLen_m:(item_mm.len_mm/1000).toFixed(2), 
            required_m:(required_mm/1000).toFixed(2), 
            cutPos:Math.floor(remaining_mm/1000) 
        });
Â  Â  }
Â  Â  renderPreview(); 
    return true;
}

function renderPreview(){
Â  Â  previewCuts.innerHTML='<h3>ê³„ì‚° ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° (ì¬ë‹¨ ìœ„ì¹˜)</h3>';
Â  Â  if(cutPlan.length===0){previewCuts.innerHTML+='<div style="padding:15px;text-align:center;color:#ccc;">ê³„ì‚°ëœ ì¬ë‹¨ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>'; return;}
Â  Â  cutPlan.forEach(item=>{
Â  Â  Â  Â  const row=document.createElement('div'); row.className='cut-row';
Â  Â  Â  Â  row.innerHTML=`<div class="cut-left"><div class="prod-name">ì œí’ˆ ${item.index}</div><div class="prod-len">${item.prodLen_m} m (í•„ìš” ê¸¸ì´:${item.required_m} m)</div></div><div class="cut-pos">${item.cutPos} m</div>`;
Â  Â  Â  Â  previewCuts.appendChild(row);
Â  Â  });
}

function showFullscreen(){
    const lens = prodList.querySelectorAll('input');
    let subText = ''; 
    let validProductsCount = 0;
    let firstValidIndex = -1;
    let lastValidIndex = -1;
    
    // 1. ìœ íš¨í•œ ì œí’ˆ ëª©ë¡ ìƒì„±
    lens.forEach((i, idx) => {
        const value = i.value.trim();
        if (value && parseFloat(value) > 0) {
            const label = `ì œí’ˆ ${idx + 1}`;
            subText += `${label} - ${parseFloat(value).toFixed(2)} m\n`; 
            if (firstValidIndex === -1) firstValidIndex = idx + 1;
            lastValidIndex = idx + 1;
            validProductsCount++;
        }
    });

    // 2. ì œí’ˆ ë²”ìœ„ ìš”ì•½ ì„¤ì •
    let summaryText = 'ì œí’ˆ ì •ë³´ ìš”ì•½';
    if (validProductsCount > 0) {
        if (firstValidIndex === lastValidIndex) {
             summaryText = `ì œí’ˆ ${firstValidIndex}`;
        } else {
             summaryText = `ì œí’ˆ ${firstValidIndex}ë¶€í„° ${lastValidIndex}ê¹Œì§€ (${validProductsCount}ê°œ)`;
        }
    }
    fsSummary.innerText = summaryText;

    // 3. ì›ë‹¨ ê¸¸ì´/ì—¬ìœ ìœ¨ ì •ë³´ í‘œì‹œ
    const total_m = totalInput.value ? parseFloat(totalInput.value).toFixed(2) : 'N/A';
    const margin_perc = marginInput.value ? parseFloat(marginInput.value).toFixed(0) : 'N/A';
    
    document.getElementById('fsInfo').innerText = 
        `ì´ ì›ë‹¨ ê¸¸ì´: ${total_m} m\nì—¬ìœ ìœ¨: ${margin_perc}%`;
    
    // 4. ìœ íš¨ ì œí’ˆ ëª©ë¡ í‘œì‹œ
    document.getElementById('fsSub').innerText = subText;

    // 5. ì¬ë‹¨ ëª©ë¡ ë Œë”ë§
    const fsCuts = document.getElementById('fsCuts'); 
    fsCuts.innerHTML = '';
    cutPlan.forEach(item => {
        const row = document.createElement('div'); row.className = 'cut-row';
        const label = `ì œí’ˆ ${item.index}`;
        
        row.innerHTML = `<div class="cut-left">
                            <div class="prod-name">${label}</div>
                            <div class="main-len">${item.prodLen_m} m</div>
                            <div class="required-len">(í•„ìš” ê¸¸ì´: ${item.required_m} m)</div>
                        </div>
                        <div class="cut-pos">${item.cutPos} m</div>`;
        fsCuts.appendChild(row);
    });

    // 6. ì „ì²´í™”ë©´ í‘œì‹œ
    fsContainer.style.display = 'flex';
}

calcBtn.addEventListener('click', () => {
    if (buildCutPlan()) { 
        if (cutPlan.length > 0) {
            saveResult(); // ğŸŒŸ ê³„ì‚° ì„±ê³µ ì‹œ ê²°ê³¼ ì €ì¥
            showFullscreen(); 
        }
    }
});

fsBtn.addEventListener('click',()=>{
    if(cutPlan.length===0){ showModal('ì•Œë¦¼','ë¨¼ì € ê³„ì‚°ì„ ìˆ˜í–‰í•´ì£¼ì„¸ìš”.',false); return; }
    showFullscreen();
});

exitBtn.addEventListener('click',()=>{fsContainer.style.display='none';});

function showModal(title,message,confirm=false,callback){
Â  Â  modalTitle.innerText=title;
Â  Â  modalMessage.innerText=message;
Â  Â  modalConfirmBtn.style.display=confirm?'inline-block':'none';
Â  Â  modalCancelBtn.innerText=confirm?'ì·¨ì†Œ':'í™•ì¸';
    // í™•ì¸ ë²„íŠ¼ì´ ìˆ¨ê²¨ì ¸ ìˆìœ¼ë©´ ì·¨ì†Œ ë²„íŠ¼ì„ í™•ì¸ ë²„íŠ¼ì²˜ëŸ¼ ë™ì‘í•˜ê²Œ í•¨
    if (!confirm) { 
        modalCancelBtn.innerText = 'í™•ì¸';
        modalCancelBtn.style.marginLeft = '0';
        modalCancelBtn.style.backgroundColor = '#3498db';
    } else {
        modalCancelBtn.innerText = 'ì·¨ì†Œ';
        modalCancelBtn.style.marginLeft = '10px';
        modalCancelBtn.style.backgroundColor = '#555';
    }

Â  Â  customModalOverlay.style.display='flex';
Â  Â  modalCallback=callback||null;
}

modalCancelBtn.addEventListener('click',()=>{
Â  Â  customModalOverlay.style.display='none';
Â  Â  if(modalCallback) modalCallback(false);
});
modalConfirmBtn.addEventListener('click',()=>{
Â  Â  customModalOverlay.style.display='none';
Â  Â  if(modalCallback) modalCallback(true);
});
});
</script>
</body>
</html>